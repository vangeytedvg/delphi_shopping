unit graphPeriods;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants,
  System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, VclTee.TeeGDIPlus, Data.DB,
  VclTee.TeEngine, VclTee.Series, Vcl.ExtCtrls, VclTee.TeeProcs, VclTee.Chart,
  VclTee.DBChart, Vcl.Grids, Vcl.DBGrids, Vcl.Menus, Printers;

type
  TFormPeriods = class(TForm)
    DBGrid1: TDBGrid;
    MainMenu1: TMainMenu;
    Graph1: TMenuItem;
    Graph2: TMenuItem;
    Exit1: TMenuItem;
    Print1: TMenuItem;
    PrintDialog: TPrintDialog;
    procedure Graph2Click(Sender: TObject);
    procedure Exit1Click(Sender: TObject);
    procedure Print1Click(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FormPeriods: TFormPeriods;

implementation

uses
  DataMod;

{$R *.dfm}

procedure TFormPeriods.Exit1Click(Sender: TObject);
begin
  Close;
end;

procedure TFormPeriods.Graph2Click(Sender: TObject);
begin
  DataModule1.PeriodQuery.Active := False;
  DataModule1.PeriodQuery.Active := True;
end;

procedure TFormPeriods.Print1Click(Sender: TObject);
// Print the contents of the grid (A4)
var
  i, j, X, Y: Integer;
  S: string;
  PageWidth, PageHeight: Integer;

begin
  // begin a page
  if PrintDialog.Execute() then
  begin

    Printer.BeginDoc;
    X := 200;
    Y := 200;
    // First print the column headers
    for i := 0 to DBGrid1.Columns.Count - 1 do
    begin
      S := DBGrid1.Columns[i].Title.Caption;
      Printer.Canvas.TextOut(X * 10, 100, S);
    end;

    // Print the data rows
    with DBGrid1.DataSource.DataSet do
    begin
      // Be sure to be on the first record
      First;
      while not Eof do
      begin
        for i := 0 to FieldCount - 1 do
        begin
          S := Fields[i].AsString;
          Printer.Canvas.TextOut(i * 40, Printer.Canvas.PenPos.Y + 100, S);
        end;
        // Go to next row
        Next;
        // Check if new page is needed
        if Printer.Canvas.PenPos.Y > Printer.PageHeight - 500 then
        begin
          Printer.EndDoc;
          Printer.NewPage;
          for i := 0 to DBGrid1.Columns.Count - 1 do
          begin
            S := DBGrid1.Columns[i].Title.Caption;
            Printer.Canvas.TextOut(i * 400, 200, S);
          end;
        end;
      end;
      Printer.EndDoc;
    end;

  end;

end;

end.
